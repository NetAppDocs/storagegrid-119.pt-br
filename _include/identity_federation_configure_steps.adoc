= Teste a conexão e salve a configuração
:allow-uri-read: 


. Selecione *Ativar federação de identidade*.
. Na seção Tipo de serviço LDAP, selecione o tipo de serviço LDAP que você deseja configurar.
+
image::../media/ldap_service_type.png[Página de Federação de Identidade mostrando opções de tipo de serviço LDAP]

+
Selecione *Outro* para configurar valores para um servidor LDAP que usa o Oracle Directory Server.

. Se você selecionou *Outro*, preencha os campos na seção Atributos LDAP. Caso contrário, vá para a próxima etapa.
+
** *Nome exclusivo do usuário*: O nome do atributo que contém o identificador exclusivo de um usuário LDAP. Este atributo é equivalente a `sAMAccountName` para o Active Directory e `uid` para OpenLDAP. Se você estiver configurando o Oracle Directory Server, insira `uid` .
** *UUID do usuário*: O nome do atributo que contém o identificador exclusivo permanente de um usuário LDAP. Este atributo é equivalente a `objectGUID` para o Active Directory e `entryUUID` para OpenLDAP. Se você estiver configurando o Oracle Directory Server, insira `nsuniqueid` . O valor de cada usuário para o atributo especificado deve ser um número hexadecimal de 32 dígitos em formato de 16 bytes ou string, onde hifens são ignorados.
** *Nome exclusivo do grupo*: O nome do atributo que contém o identificador exclusivo de um grupo LDAP. Este atributo é equivalente a `sAMAccountName` para o Active Directory e `cn` para OpenLDAP. Se você estiver configurando o Oracle Directory Server, insira `cn` .
** *UUID do grupo*: O nome do atributo que contém o identificador exclusivo permanente de um grupo LDAP. Este atributo é equivalente a `objectGUID` para o Active Directory e `entryUUID` para OpenLDAP. Se você estiver configurando o Oracle Directory Server, insira `nsuniqueid` . O valor de cada grupo para o atributo especificado deve ser um número hexadecimal de 32 dígitos em formato de 16 bytes ou string, onde hifens são ignorados.


. Para todos os tipos de serviço LDAP, insira as informações necessárias do servidor LDAP e da conexão de rede na seção Configurar servidor LDAP.
+
** *Nome do host*: O nome de domínio totalmente qualificado (FQDN) ou endereço IP do servidor LDAP.
** *Porta*: A porta usada para conectar ao servidor LDAP.
+

NOTE: A porta padrão para STARTTLS é 389, e a porta padrão para LDAPS é 636.  No entanto, você pode usar qualquer porta, desde que seu firewall esteja configurado corretamente.

** *Nome de usuário*: O caminho completo do nome distinto (DN) do usuário que se conectará ao servidor LDAP.
+
Para o Active Directory, você também pode especificar o Nome de logon de nível inferior ou o Nome principal do usuário.

+
O usuário especificado deve ter permissão para listar grupos e usuários e acessar os seguintes atributos:

+
*** `sAMAccountName`ou `uid`
*** `objectGUID`, `entryUUID` , ou `nsuniqueid`
*** `cn`
*** `memberOf`ou `isMemberOf`
*** *Active Directory*: `objectSid` , `primaryGroupID` , `userAccountControl` , e `userPrincipalName`
*** *Azul*: `accountEnabled` e `userPrincipalName`


** *Senha*: A senha associada ao nome de usuário.
+

NOTE: Se você alterar a senha no futuro, deverá atualizá-la nesta página.

** *DN base do grupo*: O caminho completo do nome distinto (DN) para uma subárvore LDAP na qual você deseja pesquisar grupos.  No exemplo do Active Directory (abaixo), todos os grupos cujo Nome Distinto é relativo ao DN base (DC=storagegrid,DC=example,DC=com) podem ser usados como grupos federados.
+

NOTE: Os valores de *Nome exclusivo do grupo* devem ser exclusivos dentro do *DN base do grupo* ao qual pertencem.

** *DN base do usuário*: O caminho completo do nome distinto (DN) de uma subárvore LDAP na qual você deseja pesquisar usuários.
+

NOTE: Os valores de *Nome exclusivo do usuário* devem ser exclusivos dentro do *DN base do usuário* ao qual pertencem.

** *Formato de nome de usuário vinculado* (opcional): O padrão de nome de usuário padrão que o StorageGRID deve usar se o padrão não puder ser determinado automaticamente.
+
É recomendável fornecer o *formato de nome de usuário de associação* porque ele pode permitir que os usuários efetuem login caso o StorageGRID não consiga se associar à conta de serviço.

+
Insira um destes padrões:

+
*** *Padrão UserPrincipalName (Active Directory e Azure)*: `[USERNAME]@_example_.com`
*** *Padrão de nome de logon de nível inferior (Active Directory e Azure)*: `_example_\[USERNAME]`
*** *Padrão de nome distinto*: `CN=[USERNAME],CN=Users,DC=_example_,DC=com`
+
Inclua *[USERNAME]* exatamente como escrito.





. Na seção Segurança da Camada de Transporte (TLS), selecione uma configuração de segurança.
+
** *Use STARTTLS*: Use STARTTLS para proteger as comunicações com o servidor LDAP. Esta é a opção recomendada para Active Directory, OpenLDAP ou Outros, mas esta opção não é suportada pelo Azure.
** *Usar LDAPS*: A opção LDAPS (LDAP sobre SSL) usa TLS para estabelecer uma conexão com o servidor LDAP. Você deve selecionar esta opção para o Azure.
** *Não use TLS*: O tráfego de rede entre o sistema StorageGRID e o servidor LDAP não será protegido.  Esta opção não é suportada pelo Azure.
+

NOTE: O uso da opção *Não usar TLS* não é suportado se o seu servidor Active Directory impõe assinatura LDAP. Você deve usar STARTTLS ou LDAPS.



. Se você selecionou STARTTLS ou LDAPS, escolha o certificado usado para proteger a conexão.
+
** *Usar certificado CA do sistema operacional*: Use o certificado CA padrão do Grid instalado no sistema operacional para proteger conexões.
** *Usar certificado CA personalizado*: Use um certificado de segurança personalizado.
+
Se você selecionar esta configuração, copie e cole o certificado de segurança personalizado na caixa de texto Certificado de CA.







=== Teste a conexão e salve a configuração

Depois de inserir todos os valores, você deve testar a conexão antes de salvar a configuração.  O StorageGRID verifica as configurações de conexão do servidor LDAP e o formato do nome de usuário de vinculação, se você forneceu um.

.Passos
. Selecione *Testar conexão*.
. Se você não forneceu um formato de nome de usuário de vinculação:
+
** A mensagem "Teste de conexão bem-sucedido" será exibida se as configurações de conexão forem válidas.  Selecione *Salvar* para salvar a configuração.
** A mensagem "não foi possível estabelecer a conexão de teste" aparece se as configurações de conexão forem inválidas.  Selecione *Fechar*.  Em seguida, resolva quaisquer problemas e teste a conexão novamente.


. Se você forneceu um formato de nome de usuário vinculado, insira o nome de usuário e a senha de um usuário federado válido.
+
Por exemplo, digite seu próprio nome de usuário e senha.  Não inclua nenhum caractere especial no nome de usuário, como @ ou /.

+
image::../media/identity_federation_test_connection.png[Prompt de federação de identidade para validar o formato de nome de usuário de vinculação]

+
** A mensagem "Teste de conexão bem-sucedido" será exibida se as configurações de conexão forem válidas.  Selecione *Salvar* para salvar a configuração.
** Uma mensagem de erro será exibida se as configurações de conexão, o formato do nome de usuário de vinculação ou o nome de usuário e a senha de teste forem inválidos.  Resolva quaisquer problemas e teste a conexão novamente.



