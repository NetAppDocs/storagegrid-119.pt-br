---
permalink: admin/grid-federation-what-is-cross-grid-replication.html 
sidebar: sidebar 
keywords: cross-grid replication, cgr, disaster recovery, grid federation 
summary: A replicação entre grades é a replicação automática de objetos entre buckets S3 selecionados em dois sistemas StorageGRID que estão conectados em uma conexão de federação de grade.  A clonagem da conta é necessária para replicação entre redes. 
---
= O que é replicação entre redes?
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
A replicação entre grades é a replicação automática de objetos entre buckets S3 selecionados em dois sistemas StorageGRID que estão conectados em umlink:grid-federation-overview.html["conexão de federação de rede"] . link:grid-federation-what-is-account-clone.html["Clone de conta"] é necessário para replicação entre grades.



== Fluxo de trabalho para replicação entre grades

O diagrama de fluxo de trabalho resume as etapas para configurar a replicação entre grades entre buckets em duas grades.

image::../media/grid-federation-cgr-workflow.png[Fluxo de trabalho de replicação entre grades]



== Requisitos para replicação entre redes

Se uma conta de locatário tiver a permissão *Usar conexão de federação de grade* para usar um ou maislink:grid-federation-overview.html["conexões de federação de rede"] , um usuário locatário com permissão de acesso Root pode criar buckets idênticos nas contas de locatário correspondentes em cada grade. Esses baldes:

* Deve ter o mesmo nome, mas pode ter regiões diferentes
* Deve ter o controle de versão habilitado
* Deve ter o bloqueio de objeto S3 desabilitado
* Deve estar vazio


Depois que ambos os buckets forem criados, a replicação entre grades poderá ser configurada para um ou ambos os buckets.

.Saber mais
link:../tenant/grid-federation-manage-cross-grid-replication.html["Gerenciar replicação entre redes"]



== Como funciona a replicação entre redes

A replicação entre grades pode ser configurada para ocorrer em uma direção ou em ambas as direções.



=== Replicação em uma direção

Se você habilitar a replicação entre grades para um bucket em apenas uma grade, os objetos adicionados a esse bucket (o bucket de origem) serão replicados para o bucket correspondente na outra grade (o bucket de destino). No entanto, os objetos adicionados ao bucket de destino não são replicados de volta para a origem. Na figura, a replicação entre grades está habilitada para `my-bucket` da Grade 1 para a Grade 2, mas não é habilitado na outra direção.

image::../media/grid-federation-cross-grid-replication-one-direction.png[imagem mostrando a conexão da federação de grade em uma direção]



=== Replicação em ambas as direções

Se você habilitar a replicação entre grades para o mesmo bucket em ambas as grades, os objetos adicionados a qualquer um dos buckets serão replicados para a outra grade.  Na figura, a replicação entre grades está habilitada para `my-bucket` em ambas as direções.

image::../media/grid-federation-cross-grid-replication.png[imagem mostrando replicação em uma direção comparada à replicação em ambas as direções]



=== O que acontece quando objetos são ingeridos?

Quando um cliente S3 adiciona um objeto a um bucket que tem a replicação entre grades habilitada, acontece o seguinte:

. O StorageGRID replica automaticamente o objeto do bucket de origem para o bucket de destino.  O tempo para executar esta operação de replicação em segundo plano depende de vários fatores, incluindo o número de outras operações de replicação pendentes.
+
O cliente S3 pode verificar o status de replicação de um objeto emitindo uma solicitação GetObject ou HeadObject. A resposta inclui um StorageGRID específico `x-ntap-sg-cgr-replication-status` cabeçalho de resposta, que terá um dos seguintes valores: O cliente S3 pode verificar o status de replicação de um objeto emitindo uma solicitação GetObject ou HeadObject.  A resposta inclui um StorageGRID específico `x-ntap-sg-cgr-replication-status` cabeçalho de resposta, que terá um dos seguintes valores:

+
[cols="1a,2a"]
|===
| Grade | Status de replicação 


 a| 
Fonte
 a| 
** *CONCLUÍDO*: A replicação foi bem-sucedida para todas as conexões de rede.
** *PENDENTE*: O objeto não foi replicado para pelo menos uma conexão de grade.
** *FALHA*: A replicação não está pendente para nenhuma conexão de rede e pelo menos uma falhou com uma falha permanente. Um usuário deve resolver o erro.




 a| 
Destino
 a| 
*REPLICA*: O objeto foi replicado da grade de origem.

|===
+

NOTE: O StorageGRID não oferece suporte a `x-amz-replication-status` cabeçalho.

. O StorageGRID usa as políticas de ILM ativas de cada grade para gerenciar os objetos, assim como faria com qualquer outro objeto.  Por exemplo, o Objeto A na Grade 1 pode ser armazenado como duas cópias replicadas e retido para sempre, enquanto a cópia do Objeto A que foi replicada na Grade 2 pode ser armazenada usando codificação de eliminação 2+1 e excluída após três anos.




=== O que acontece quando objetos são excluídos?

Conforme descrito emlink:../primer/delete-data-flow.html["Excluir fluxo de dados"] O StorageGRID pode excluir um objeto por qualquer um destes motivos:

* O cliente S3 emite uma solicitação de exclusão.
* Um usuário do Gerenciador de Inquilinos seleciona olink:../tenant/deleting-s3-bucket-objects.html["Excluir objetos no bucket"] opção para remover todos os objetos de um bucket.
* O bucket tem uma configuração de ciclo de vida, que expira.
* O último período de tempo na regra ILM para o objeto termina e não há mais posicionamentos especificados.


Quando o StorageGRID exclui um objeto devido a uma operação Excluir objetos no bucket, expiração do ciclo de vida do bucket ou expiração do posicionamento do ILM, o objeto replicado nunca é excluído da outra grade em uma conexão de federação de grade.  No entanto, os marcadores de exclusão adicionados ao bucket de origem pelas exclusões do cliente S3 podem, opcionalmente, ser replicados para o bucket de destino.

Para entender o que acontece quando um cliente S3 exclui objetos de um bucket que tem a replicação entre grades habilitada, revise como os clientes S3 excluem objetos de buckets que têm o controle de versão habilitado, da seguinte maneira:

* Se um cliente S3 emitir uma solicitação de exclusão que inclua um ID de versão, essa versão do objeto será removida permanentemente.  Nenhum marcador de exclusão é adicionado ao bucket.
* Se um cliente S3 emitir uma solicitação de exclusão que não inclua um ID de versão, o StorageGRID não excluirá nenhuma versão de objeto. Em vez disso, ele adiciona um marcador de exclusão ao bucket. O marcador de exclusão faz com que o StorageGRID aja como se o objeto tivesse sido excluído:
+
** Uma solicitação GetObject sem um ID de versão falhará com `404 No Object Found`
** Uma solicitação GetObject com um ID de versão válido será bem-sucedida e retornará a versão do objeto solicitada.




Quando um cliente S3 exclui um objeto de um bucket que tem a replicação entre grades habilitada, o StorageGRID determina se deve replicar a solicitação de exclusão para o destino, da seguinte maneira:

* Se a solicitação de exclusão incluir um ID de versão, essa versão do objeto será removida permanentemente da grade de origem. No entanto, o StorageGRID não replica solicitações de exclusão que incluem um ID de versão, portanto, a mesma versão do objeto não é excluída do destino.
* Se a solicitação de exclusão não incluir um ID de versão, o StorageGRID poderá, opcionalmente, replicar o marcador de exclusão, com base em como a replicação entre grades estiver configurada para o bucket:
+
** Se você optar por replicar marcadores de exclusão (padrão), um marcador de exclusão será adicionado ao bucket de origem e replicado no bucket de destino.  Na verdade, o objeto parece ter sido excluído em ambas as grades.
** Se você optar por não replicar os marcadores de exclusão, um marcador de exclusão será adicionado ao bucket de origem, mas não será replicado no bucket de destino. Na verdade, objetos que são excluídos na grade de origem não são excluídos na grade de destino.




Na figura, *Replicar marcadores de exclusão* foi definido como *Sim* quandolink:../tenant/grid-federation-manage-cross-grid-replication.html["a replicação entre grades foi habilitada"] . Solicitações de exclusão para o bucket de origem que incluem um ID de versão não excluirão objetos do bucket de destino.  Solicitações de exclusão para o bucket de origem que não incluem um ID de versão aparecerão para excluir objetos no bucket de destino.

image::../media/grid-federation-cross-grid-replication-delete.png[imagem mostrando a exclusão do cliente replicado em ambas as grades]


NOTE: Se você deseja manter as exclusões de objetos sincronizadas entre as grades, crie as correspondenteslink:../s3/create-s3-lifecycle-configuration.html["Configurações do ciclo de vida S3"] para os baldes em ambas as grades.



=== Como os objetos criptografados são replicados

Ao usar a replicação entre grades para replicar objetos entre grades, você pode criptografar objetos individuais, usar a criptografia de bucket padrão ou configurar a criptografia em toda a grade.  Você pode adicionar, modificar ou remover configurações de criptografia padrão de bucket ou de toda a grade antes ou depois de habilitar a replicação entre grades para um bucket.

Para criptografar objetos individuais, você pode usar SSE (criptografia do lado do servidor com chaves gerenciadas StorageGRID) ao adicionar os objetos ao bucket de origem.  Use o `x-amz-server-side-encryption` cabeçalho da solicitação e especificar `AES256` . Ver link:../s3/using-server-side-encryption.html["Use criptografia do lado do servidor"] .


NOTE: O uso de SSE-C (criptografia do lado do servidor com chaves fornecidas pelo cliente) não é suportado para replicação entre redes. A operação de ingestão falhará.

Para usar a criptografia padrão para um bucket, use uma solicitação PutBucketEncryption e defina o `SSEAlgorithm` parâmetro para `AES256` .  A criptografia em nível de bucket se aplica a todos os objetos ingeridos sem o `x-amz-server-side-encryption` cabeçalho da solicitação. Ver link:../s3/operations-on-buckets.html["Operações em baldes"] .

Para usar a criptografia em nível de grade, defina a opção *Criptografia de objeto armazenado* como *AES-256*.  A criptografia em nível de grade se aplica a todos os objetos que não são criptografados no nível do bucket ou que são ingeridos sem o `x-amz-server-side-encryption` cabeçalho da solicitação. Ver link:../admin/changing-network-options-object-encryption.html["Configurar opções de rede e objeto"] .


NOTE: O SSE não suporta AES-128.  Se a opção *Criptografia de objeto armazenado* estiver habilitada para a grade de origem usando a opção *AES-128*, o uso do algoritmo AES-128 não será propagado para o objeto replicado.  Em vez disso, o objeto replicado usará a configuração de criptografia padrão do bucket ou do nível de grade do destino, se disponível.

Ao determinar como criptografar objetos de origem, o StorageGRID aplica estas regras:

. Use o `x-amz-server-side-encryption` cabeçalho de ingestão, se presente.
. Se um cabeçalho de ingestão não estiver presente, use a configuração de criptografia padrão do bucket, se configurada.
. Se uma configuração de bucket não estiver configurada, use a configuração de criptografia em toda a grade, se configurada.
. Se uma configuração para toda a grade não estiver presente, não criptografe o objeto de origem.


Ao determinar como criptografar objetos replicados, o StorageGRID aplica estas regras nesta ordem:

. Use a mesma criptografia do objeto de origem, a menos que esse objeto use criptografia AES-128.
. Se o objeto de origem não estiver criptografado ou usar AES-128, use a configuração de criptografia padrão do bucket de destino, se configurada.
. Se o bucket de destino não tiver uma configuração de criptografia, use a configuração de criptografia em toda a grade do destino, se configurada.
. Se uma configuração para toda a grade não estiver presente, não criptografe o objeto de destino.




=== PutObjectTagging e DeleteObjectTagging não são suportados

As solicitações PutObjectTagging e DeleteObjectTagging não são suportadas para objetos em buckets que tenham replicação entre grades habilitada.

Se um cliente S3 emitir uma solicitação PutObjectTagging ou DeleteObjectTagging, `501 Not Implemented` é retornado. A mensagem é `Put(Delete) ObjectTagging is not available for buckets that have cross-grid replication configured` .



=== Como objetos segmentados são replicados

O tamanho máximo do segmento da grade de origem se aplica a objetos replicados na grade de destino. Quando objetos são replicados para outra grade, a configuração *Tamanho Máximo do Segmento* (*CONFIGURAÇÃO* > *Sistema* > *Opções de armazenamento*) da grade de origem será usada em ambas as grades. Por exemplo, suponha que o tamanho máximo do segmento para a grade de origem seja 1 GB, enquanto o tamanho máximo do segmento da grade de destino seja 50 MB. Se você ingerir um objeto de 2 GB na grade de origem, esse objeto será salvo como dois segmentos de 1 GB.  Ele também será replicado para a grade de destino como dois segmentos de 1 GB, embora o tamanho máximo do segmento dessa grade seja 50 MB.
